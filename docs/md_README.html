<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>iir1: DSP IIR Realtime C++ filter library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">iir1
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">DSP IIR Realtime C++ filter library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><img src="title.png" alt="alt tag" class="inline"/></p>
<p>An infinite impulse response (IIR) filter library for Linux, Mac OSX and Windows which implements Butterworth, RBJ, Chebychev filters and can easily import coefficients generated by Python (scipy).</p>
<p>The filter processes the data sample by sample for realtime processing.</p>
<p>It uses templates to allocate the required memory so that it can run without any malloc / new commands. Memory is allocated at compile time so that there is never the risk of memory leaks.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
C++ code</h1>
<p>Add the following include statement to your code: </p><div class="fragment"><div class="line">#include &quot;Iir.h&quot;</div>
</div><!-- fragment --><p>The general coding approach is that first the filter is instantiated specifying its order, then the parameters are set with the function <code>setup</code> and then it's ready to be used for sample by sample realtime filtering.</p>
<h2><a class="anchor" id="autotoc_md2"></a>
Setting the filter parameters</h2>
<p>All filters are available as lowpass, highpass, bandpass and bandstop/notch filters. Butterworth / Chebyshev offer also low/high/band-shelves with specified passband gain and 0dB gain in the stopband.</p>
<p>The frequencies can either be analogue ones against the sampling rate or normalised ones between 0..1/2 where 1/2 is the Nyquist frequency. Note that normalised frequencies are simply f = F/Fs and are in units of 1/samples. Internally the library uses normalised frequencies and the setup commands simply divide by the sampling rate if given. Choose between:</p><ol type="1">
<li><code>setup</code>: sampling rate and the analogue cutoff frequencies</li>
<li><code>setupN</code>: normalised frequencies in 1/samples between f = 0..1/2 where 1/2 = Nyquist.</li>
</ol>
<p>See the header files in <code>\iir</code> or the documentation for the arguments of the <code>setup</code> commands.</p>
<p>The examples below are for lowpass filters:</p>
<ol type="1">
<li>Butterworth &ndash; <code><a class="el" href="Butterworth_8h_source.html">Butterworth.h</a></code> Standard filter suitable for most applications. Monotonic response. <div class="fragment"><div class="line">const int order = 4; // 4th order (=2 biquads)</div>
<div class="line">Iir::Butterworth::LowPass&lt;order&gt; f;</div>
<div class="line">const float samplingrate = 1000; // Hz</div>
<div class="line">const float cutoff_frequency = 5; // Hz</div>
<div class="line">f.setup (samplingrate, cutoff_frequency);</div>
</div><!-- fragment --></li>
</ol>
<p>or specify a normalised frequency between 0..1/2: </p><div class="fragment"><div class="line">f.setupN(norm_cutoff_frequency);</div>
</div><!-- fragment --><ol type="1">
<li>Chebyshev Type I &ndash; <code><a class="el" href="ChebyshevI_8h_source.html">ChebyshevI.h</a></code> With permissible passband ripple in dB. <div class="fragment"><div class="line">Iir::ChebyshevI::LowPass&lt;order&gt; f;</div>
<div class="line">const float passband_ripple_in_db = 5;</div>
<div class="line">f.setup (samplingrate,</div>
<div class="line">         cutoff_frequency,</div>
<div class="line">         passband_ripple_in_dB);</div>
</div><!-- fragment --></li>
</ol>
<p>or specify a normalised frequency between 0..1/2: </p><div class="fragment"><div class="line">f.setupN(norm_cutoff_frequency,passband_ripple_in_dB);</div>
</div><!-- fragment --><ol type="1">
<li>Chebyshev Type II &ndash; <code><a class="el" href="ChebyshevII_8h_source.html">ChebyshevII.h</a></code> With worst permissible stopband rejection in dB. <div class="fragment"><div class="line">Iir::ChebyshevII::LowPass&lt;order&gt; f;</div>
<div class="line">double stopband_ripple_in_dB = 20;</div>
<div class="line">f.setup (samplingrate,</div>
<div class="line">         cutoff_frequency,</div>
<div class="line">         stopband_ripple_in_dB);</div>
</div><!-- fragment --></li>
</ol>
<p>or specify a normalised frequency between 0..1/2: </p><div class="fragment"><div class="line">f.setupN(norm_cutoff_frequency,stopband_ripple_in_dB);</div>
</div><!-- fragment --><ol type="1">
<li>RBJ &ndash; <code><a class="el" href="RBJ_8h_source.html">RBJ.h</a></code> 2nd order filters with cutoff and Q factor. <div class="fragment"><div class="line">Iir::RBJ::LowPass f;</div>
<div class="line">const float cutoff_frequency = 100;</div>
<div class="line">const float Q_factor = 5;</div>
<div class="line">f.setup (samplingrate, cutoff_frequency, Q_factor);</div>
</div><!-- fragment --></li>
</ol>
<p>or specify a normalised frequency between 0..1/2: </p><div class="fragment"><div class="line">f.setupN(norm_cutoff_frequency, Q_factor);</div>
</div><!-- fragment --><ol type="1">
<li>Designing filters with Python's scipy.signal &ndash; <code><a class="el" href="Custom_8h_source.html">Custom.h</a></code> <div class="fragment"><div class="line">########</div>
<div class="line"># Python</div>
<div class="line"># See &quot;elliptic_design.py&quot; for the complete code.</div>
<div class="line">from scipy import signal</div>
<div class="line">order = 4</div>
<div class="line">sos = signal.ellip(order, 5, 40, 0.2, &#39;low&#39;, output=&#39;sos&#39;)</div>
<div class="line">print(sos) # copy/paste the coefficients over &amp; replace [] with {}</div>
<div class="line"> </div>
<div class="line">///////</div>
<div class="line">// C++</div>
<div class="line">// part of &quot;iirdemo.cpp&quot;</div>
<div class="line">const double coeff[][6] = {</div>
<div class="line">                {1.665623674062209972e-02,</div>
<div class="line">                 -3.924801366970616552e-03,</div>
<div class="line">                 1.665623674062210319e-02,</div>
<div class="line">                 1.000000000000000000e+00,</div>
<div class="line">                 -1.715403014004022175e+00,</div>
<div class="line">                 8.100474793174089472e-01},</div>
<div class="line">                {1.000000000000000000e+00,</div>
<div class="line">                 -1.369778997100624895e+00,</div>
<div class="line">                 1.000000000000000222e+00,</div>
<div class="line">                 1.000000000000000000e+00,</div>
<div class="line">                 -1.605878925999785656e+00,</div>
<div class="line">                 9.538657786383895054e-01}</div>
<div class="line">        };</div>
<div class="line">const int nSOS = sizeof(coeff) / sizeof(coeff[0]); // here: nSOS = 2 = order / 2</div>
<div class="line">Iir::Custom::SOSCascade&lt;nSOS&gt; cust(coeff);</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md3"></a>
Realtime filtering sample by sample</h2>
<p>Samples are processed one by one. In the example below a sample <code>x</code> is processed with the <code>filter</code> command and then saved in <code>y</code>. The types of <code>x</code> and <code>y</code> can either be float or double (integer is also allowed but is still processed internally as floating point): </p><div class="fragment"><div class="line">y = f.filter(x);</div>
</div><!-- fragment --><p>This is then repeated for every incoming sample in a loop or event handler.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Error handling</h2>
<p>Invalid values provided to <code>setup()</code> will throw an exception. Parameters provided to <code>setup()</code> which result in coefficients being NAN will also throw an exception.</p>
<h1><a class="anchor" id="autotoc_md5"></a>
Linking</h1>
<h2><a class="anchor" id="autotoc_md6"></a>
CMake setup</h2>
<p>If you use cmake as your build system then just add to your <code>CMakeLists.txt</code> the following lines for the dynamic library: </p><div class="fragment"><div class="line">find_package(iir)</div>
<div class="line">target_link_libraries(... iir::iir)</div>
</div><!-- fragment --><p>or for the static one: </p><div class="fragment"><div class="line">find_package(iir)</div>
<div class="line">target_link_libraries(... iir::iir_static)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md7"></a>
Generic linker setup</h2>
<p>Link it against the dynamic library (Unix/Mac: <code>-liir</code>, Windows: <code>iir.lib</code>) or the static library (Unix/Mac: <code>libiir_static.a</code>, Windows: <code>libiir_static.lib</code>).</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Packages for Ubuntu (xenial / bionic / focal):</h1>
<p>If you have Ubuntu's LTS distros xenial, bionic or focal then install it as a pre-compiled package:</p>
<div class="fragment"><div class="line">sudo add-apt-repository ppa:berndporr/dsp</div>
</div><!-- fragment --><p>It's available for 32,64 bit PC and 32,64 bit ARM (Raspberry PI etc). The documentation and the example programs are in: </p><div class="fragment"><div class="line">/usr/share/doc/iir1-dev/</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md9"></a>
Package for MacOS</h1>
<p>Make sure you have the homebrew package manager installed: <a href="https://brew.sh/">https://brew.sh/</a></p>
<p>Add the homebrew tap:</p>
<div class="fragment"><div class="line">brew tap berndporr/dsp</div>
</div><!-- fragment --><p>and then install the iir filter package with:</p>
<div class="fragment"><div class="line">brew install iir</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md10"></a>
Compilation from source</h1>
<p>The build tool is <code>cmake</code> which generates the make- or project files for the different platforms. <code>cmake</code> is available for Linux, Windows and Mac. It also compiles directly on a Raspberry PI.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Linux / Mac</h2>
<p>Run </p><div class="fragment"><div class="line">cmake .</div>
</div><!-- fragment --><p>which generates the Makefile. Then run: </p><div class="fragment"><div class="line">make</div>
<div class="line">sudo make install</div>
</div><!-- fragment --><p>which installs it under <code>/usr/local/lib</code> and <code>/usr/local/include</code>.</p>
<p>Both gcc and clang have been tested.</p>
<h2><a class="anchor" id="autotoc_md12"></a>
Windows</h2>
<div class="fragment"><div class="line">cmake -G &quot;Visual Studio 15 2017 Win64&quot; .</div>
</div><!-- fragment --><p>See <code>cmake</code> for the different build-options. Above is for a 64 bit build. Then start Visual C++ and open the solution. This will create the DLL and the LIB files. Under Windows it's highly recommended to use the static library and link it into the application program.</p>
<h2><a class="anchor" id="autotoc_md13"></a>
Unit tests</h2>
<p>Run unit tests by typing <code>make test</code> or just <code>ctest</code>. These test if after a delta pulse all filters relax to zero and that their outputs never become NaN.</p>
<h1><a class="anchor" id="autotoc_md14"></a>
Documentation</h1>
<h2><a class="anchor" id="autotoc_md15"></a>
Learn from the demos</h2>
<p>The easiest way to learn is from the examples which are in the <code>demo</code> directory. A delta pulse as a test signal is sent into the different filters and saved in a file. With the Python script <code>plot_impulse_fresponse.py</code> you can then plot the frequency responses.</p>
<p>Also the directory containing the unit tests provides examples for every filter type.</p>
<h2><a class="anchor" id="autotoc_md16"></a>
Detailed documentation</h2>
<p>A PDF of all classes, methods and in particular <code>setup</code> functions is in the <code>docs/pdf</code> directory.</p>
<p>The online documentation is here: <a href="http://berndporr.github.io/iir1">http://berndporr.github.io/iir1</a></p>
<h1><a class="anchor" id="autotoc_md17"></a>
Example filter responses</h1>
<p>These responses have been generated by <code>iirdemo.cpp</code> in the <code>/demo/</code> directory and then plotted with <code>plot_impulse_fresponse.py</code>.</p>
<p><img src="demo/1.png" alt="alt tag" class="inline"/> <img src="demo/2.png" alt="alt tag" class="inline"/> <img src="demo/3.png" alt="alt tag" class="inline"/> <img src="demo/4.png" alt="alt tag" class="inline"/> <img src="demo/5.png" alt="alt tag" class="inline"/> <img src="demo/7.png" alt="alt tag" class="inline"/> <img src="demo/8.png" alt="alt tag" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md18"></a>
Credits</h1>
<p>This library has been further developed from Vinnie Falco's great original work which can be found here:</p>
<p><a href="https://github.com/vinniefalco/DSPFilters">https://github.com/vinniefalco/DSPFilters</a></p>
<p>While the original library processes audio arrays this library has been adapted to do fast realtime processing sample by sample. The <code>setup</code> command won't require the filter order and instead remembers it from the template argument. The class structure has been simplified and all functions documented for doxygen. Instead of having assert() statements this libary throws exceptions in case a parameter is wrong. Any filter design requiring optimisation (for example Ellipic filters) has been removed and instead a function has been added which can import easily coefficients from scipy.</p>
<h1><a class="anchor" id="autotoc_md19"></a>
Bibliography</h1>
<div class="fragment"><div class="line">&quot;High-Order Digital Parametric Equalizer Design&quot;</div>
<div class="line"> Sophocles J. Orfanidis</div>
<div class="line"> (Journal of the Audio Engineering Society, vol 53. pp 1026-1046)</div>
<div class="line"> </div>
<div class="line">&quot;Spectral Transformations for digital filters&quot;</div>
<div class="line"> A. G. Constantinides, B.Sc.(Eng.) Ph.D.</div>
<div class="line"> (Proceedings of the IEEE, vol. 117, pp. 1585-1590, August 1970)</div>
</div><!-- fragment --><p>Enjoy!</p>
<p>Bernd Porr &ndash; <a href="http://www.berndporr.me.uk">http://www.berndporr.me.uk</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun May 9 2021 23:28:49 for iir1 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
